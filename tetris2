#include "block.h"
#include <Windows.h>
#include <stdio.h>
#include <stdlib.h> 
#include <time.h>
#include <conio.h>

#define WIDTH  12
#define HEIGHT 13

void eraseBlock(HANDLE hConsole, int block, int x, int y) {
	for (int i = 0; i < 4; i++) {
		for (int j = 0; j < 4; j++) {
			if (blockModel[block][i][j] == 1) {
				COORD pos = { (x + j) * 2, y + i };
				SetConsoleCursorPosition(hConsole, pos);
				printf("  ");
			}
		}
	}
}

void drawBlock(HANDLE hConsole, int block, int x, int y) {
	for (int i = 0; i < 4; i++) {
		for (int j = 0; j < 4; j++) {
			if (blockModel[block][i][j] == 1) {
				COORD pos = { (x + j) * 2, y + i };
				SetConsoleCursorPosition(hConsole, pos);
				printf("■");
			}
		}
	}
}

void blockSpawn(int x1) {
	HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
	srand(time(NULL));
	int block = (rand() % 7) * 4 ;
	int x = WIDTH / 2;
	int y = 0;

	while (y < HEIGHT - 4) {
		int time = 0;
		int key = 0;
		drawBlock(hConsole, block, x, y);
		while (time < 1000) {
			key = _getch();
			if (key == 224) {
				key = _getch();
				if (key == 75){ // 왼쪽
					eraseBlock(hConsole, block, x, y);
					if (x >= 1) {
						x--;
					}
					drawBlock(hConsole, block, x, y);
				}

				if (key == 77) { // 오른쪽
					eraseBlock(hConsole, block, x, y);
					if (x <= 15) {
						x++;
					}
					drawBlock(hConsole, block, x, y);
				}

				if (key == 72) { // 위
					eraseBlock(hConsole, block, x, y);
					drawBlock(hConsole, block, x, y);
				}

			}
			Sleep(10);
			time += 10;
		}
		eraseBlock(hConsole, block, x, y);
		y++;
	}
	drawBlock(hConsole, block, x, y);
}


int main() {
	HANDLE hConsoleOut = GetStdHandle(STD_OUTPUT_HANDLE);
	//바닥
	for (int i = 0; i < 11; i++) {
		COORD pos1 = { i, 12 };
		SetConsoleCursorPosition(hConsoleOut, pos1);
		printf("■");
	}

	blockSpawn(0);
	blockSpawn(3);

}
